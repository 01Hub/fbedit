
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	Clock.a51
	Object File:	Clock.hex
	List File:	Clock.lst



 Line  I  Addr  Code            Source

    1:
    2:
    3:		N      0040	LCDBUFF		equ	40h
    4:		N	 00	CLOCKFLAG	bit	00h
    5:		N	 01	CLOCKSETFLAG	bit	01h
    6:		N	 02	CLOCKBLINKFLAG	bit	02h
    7:		N      0050	CLOCKSETSEL	equ	50h
    8:
    9:				;RESET:***********************************************
   10:		N      0000			ORG	0000h
   11:	  0000	01 2C				AJMP	START
   12:				;IE0IRQ:**********************************************
   13:		N      0003			ORG	0003h
   14:	  0003	32				RETI
   15:				;TF0IRQ:**********************************************
   16:		N      000B			ORG	000Bh
   17:	  000B	21 0F				AJMP	CLOCKINT
   18:				;IE1IRQ:**********************************************
   19:		N      0013			ORG	0013h
   20:	  0013	32				RETI
   21:				;TF1IRQ:**********************************************
   22:		N      001B			ORG	001Bh
   23:	  001B	32				RETI
   24:				;RITIIRQ:*********************************************
   25:		N      0023			ORG	0023h
   26:	  0023	32				RETI
   27:				;TF2EXF2IRQ:******************************************
   28:		N      002B			ORG	002Bh
   29:	  002B	32				RETI
   30:				;*****************************************************
   31:
   32:	  002C	31 BC		START:		ACALL	LCDCLEARBUFF
   33:	  002E	31 A3				ACALL	LCDINIT
   34:	  0030	31 8C				ACALL	LCDCLEAR
   35:	  0032	11 9E				ACALL	CLOCKSHOW
   36:	  0034	75 89 02			MOV	TMOD,#02h	;8 bit auto reload
   37:	  0037	75 8A 9B			MOV	TL0,#255-100
   38:	  003A	75 8C 9C			MOV	TH0,#256-100	;100us intervall
   39:	  003D	75 A8 82			MOV	IE,#82h		;Enable timer 0 interrupt
   40:	  0040	7F 64				MOV	R7,#100
   41:	  0042	7E 64				MOV	R6,#100
   42:	  0044	75 88 10			MOV	TCON,#10h	;Start timer 0
   43:	  0047	C2 01		START1:		CLR	CLOCKSETFLAG

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  0049	75 50 00			MOV	CLOCKSETSEL,#00h
   45:	  004C	30 90 0B	START2:		JNB	P1.0,CLOCKSET
   46:	  004F	30 00 06			JNB	CLOCKFLAG,START3
   47:	  0052	C2 00				CLR	CLOCKFLAG
   48:	  0054	11 7F				ACALL	CLOCKINC
   49:	  0056	11 9E				ACALL	CLOCKSHOW
   50:	  0058	80 F2		START3:		SJMP	START2		;Enter endless loop
   51:
   52:	  005A	75 50 01	CLOCKSET:	MOV	CLOCKSETSEL,#01h
   53:	  005D	D2 01				SETB	CLOCKSETFLAG
   54:	  005F	30 90 FD	CLOCKSET1:	JNB	P1.0,CLOCKSET1
   55:	  0062	20 90 FD	CLOCKSET2:	JB	P1.0,CLOCKSET2
   56:	  0065	75 50 02			MOV	CLOCKSETSEL,#02h
   57:	  0068	30 90 FD	CLOCKSET3:	JNB	P1.0,CLOCKSET3
   58:	  006B	20 90 FD	CLOCKSET4:	JB	P1.0,CLOCKSET4
   59:	  006E	75 50 03			MOV	CLOCKSETSEL,#03h
   60:	  0071	30 90 FD	CLOCKSET5:	JNB	P1.0,CLOCKSET5
   61:	  0074	20 90 FD	CLOCKSET6:	JB	P1.0,CLOCKSET6
   62:	  0077	75 50 00			MOV	CLOCKSETSEL,#00h
   63:	  007A	30 90 FD	CLOCKSET7:	JNB	P1.0,CLOCKSET7
   64:	  007D	80 C8				SJMP	START1
   65:
   66:	  007F	EA		CLOCKINC:	MOV	A,R2
   67:	  0080	24 01				ADD	A,#01h
   68:	  0082	D4				DA	A
   69:	  0083	FA				MOV	R2,A
   70:	  0084	B4 60 16			CJNE	A,#60h,CLOCKINCEX
   71:	  0087	7A 00				MOV	R2,#00h
   72:	  0089	EB				MOV	A,R3
   73:	  008A	24 01				ADD	A,#01h
   74:	  008C	D4				DA	A
   75:	  008D	FB				MOV	R3,A
   76:	  008E	B4 60 0C			CJNE	A,#60h,CLOCKINCEX
   77:	  0091	7B 00				MOV	R3,#00h
   78:	  0093	EC				MOV	A,R4
   79:	  0094	24 01				ADD	A,#01h
   80:	  0096	D4				DA	A
   81:	  0097	FC				MOV	R4,A
   82:	  0098	B4 24 02			CJNE	A,#24h,CLOCKINCEX
   83:	  009B	7C 00				MOV	R4,#00h
   84:	  009D	22		CLOCKINCEX:	RET
   85:
   86:	  009E	74 04		CLOCKSHOW:	MOV	A,#04h
   87:	  00A0	31 97				ACALL	LCDSETADR
   88:	  00A2	AD 50				MOV	R5,CLOCKSETSEL
   89:	  00A4	78 40				MOV	R0,#LCDBUFF
   90:	  00A6	EC				MOV	A,R4		;Hours
   91:	  00A7	C4				SWAP	A
   92:	  00A8	54 0F				ANL	A,#0Fh
   93:	  00AA	44 30				ORL	A,#30h
   94:	  00AC	BD 01 05			CJNE	R5,#01h,CLOCKSHOW1
   95:	  00AF	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW1
   96:	  00B2	74 20				MOV	A,#20h
   97:	  00B4	F6		CLOCKSHOW1:	MOV	@R0,A
   98:	  00B5	08				INC	R0
   99:	  00B6	EC				MOV	A,R4		;Hours

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:	  00B7	54 0F				ANL	A,#0Fh
  101:	  00B9	44 30				ORL	A,#30h
  102:	  00BB	BD 01 05			CJNE	R5,#01h,CLOCKSHOW2
  103:	  00BE	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW2
  104:	  00C1	74 20				MOV	A,#20h
  105:	  00C3	F6		CLOCKSHOW2:	MOV	@R0,A
  106:	  00C4	08				INC	R0
  107:	  00C5	76 3A				MOV	@R0,#':'
  108:	  00C7	08				INC	R0
  109:	  00C8	EB				MOV	A,R3		;Minutes
  110:	  00C9	C4				SWAP	A
  111:	  00CA	54 0F				ANL	A,#0Fh
  112:	  00CC	44 30				ORL	A,#30h
  113:	  00CE	BD 02 05			CJNE	R5,#02h,CLOCKSHOW3
  114:	  00D1	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW3
  115:	  00D4	74 20				MOV	A,#20h
  116:	  00D6	F6		CLOCKSHOW3:	MOV	@R0,A
  117:	  00D7	08				INC	R0
  118:	  00D8	EB				MOV	A,R3		;Minutes
  119:	  00D9	54 0F				ANL	A,#0Fh
  120:	  00DB	44 30				ORL	A,#30h
  121:	  00DD	BD 02 05			CJNE	R5,#02h,CLOCKSHOW4
  122:	  00E0	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW4
  123:	  00E3	74 20				MOV	A,#20h
  124:	  00E5	F6		CLOCKSHOW4:	MOV	@R0,A
  125:	  00E6	08				INC	R0
  126:	  00E7	76 3A				MOV	@R0,#':'
  127:	  00E9	08				INC	R0
  128:	  00EA	EA				MOV	A,R2		;Seconds
  129:	  00EB	C4				SWAP	A
  130:	  00EC	54 0F				ANL	A,#0Fh
  131:	  00EE	44 30				ORL	A,#30h
  132:	  00F0	BD 03 05			CJNE	R5,#03h,CLOCKSHOW5
  133:	  00F3	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW5
  134:	  00F6	74 20				MOV	A,#20h
  135:	  00F8	F6		CLOCKSHOW5:	MOV	@R0,A
  136:	  00F9	08				INC	R0
  137:	  00FA	EA				MOV	A,R2		;Seconds
  138:	  00FB	54 0F				ANL	A,#0Fh
  139:	  00FD	44 30				ORL	A,#30h
  140:	  00FF	BD 03 05			CJNE	R5,#03h,CLOCKSHOW6
  141:	  0102	30 02 02			JNB	CLOCKBLINKFLAG,CLOCKSHOW6
  142:	  0105	74 20				MOV	A,#20h
  143:	  0107	F6		CLOCKSHOW6:	MOV	@R0,A
  144:	  0108	78 40				MOV	R0,#LCDBUFF
  145:	  010A	7D 08				MOV	R5,#8
  146:	  010C	31 9C				ACALL	LCDPRINTSTR
  147:	  010E	22				RET
  148:
  149:	  010F	20 01 0B	CLOCKINT:	JB	CLOCKSETFLAG,CLOCKSETINT
  150:	  0112	DF 08				DJNZ	R7,CLOCKINTEX
  151:	  0114	7F 64				MOV	R7,#100
  152:	  0116	DE 04				DJNZ	R6,CLOCKINTEX
  153:	  0118	7E 64				MOV	R6,#100
  154:	  011A	D2 00				SETB	CLOCKFLAG
  155:	  011C	32		CLOCKINTEX:	RETI

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  011D	DF FD		CLOCKSETINT:	DJNZ	R7,CLOCKINTEX
  157:	  011F	7F 64				MOV	R7,#100
  158:	  0121	DE F9				DJNZ	R6,CLOCKINTEX
  159:	  0123	7E 19				MOV	R6,#25
  160:	  0125	B2 02				CPL	CLOCKBLINKFLAG
  161:	  0127	20 91 2B			JB	P1.1,CLOCKSETINTEX
  162:	  012A	C2 02				CLR	CLOCKBLINKFLAG
  163:	  012C	AD 50				MOV	R5,CLOCKSETSEL
  164:	  012E	BD 03 0A			CJNE	R5,#03h,CLOCKSETINT1
  165:	  0131	EA				MOV	A,R2
  166:	  0132	24 01				ADD	A,#01h
  167:	  0134	D4				DA	A
  168:	  0135	FA				MOV	R2,A
  169:	  0136	B4 60 02			CJNE	A,#60h,CLOCKSETINT1
  170:	  0139	7A 00				MOV	R2,#00h
  171:	  013B	BD 02 0A	CLOCKSETINT1:	CJNE	R5,#02h,CLOCKSETINT2
  172:	  013E	EB				MOV	A,R3
  173:	  013F	24 01				ADD	A,#01h
  174:	  0141	D4				DA	A
  175:	  0142	FB				MOV	R3,A
  176:	  0143	B4 60 02			CJNE	A,#60h,CLOCKSETINT2
  177:	  0146	7B 00				MOV	R3,#00h
  178:	  0148	BD 01 0A	CLOCKSETINT2:	CJNE	R5,#01h,CLOCKSETINTEX
  179:	  014B	EC				MOV	A,R4
  180:	  014C	24 01				ADD	A,#01h
  181:	  014E	D4				DA	A
  182:	  014F	FC				MOV	R4,A
  183:	  0150	B4 24 02			CJNE	A,#24h,CLOCKSETINTEX
  184:	  0153	7C 00				MOV	R4,#00h
  185:	  0155	11 9E		CLOCKSETINTEX:	ACALL	CLOCKSHOW
  186:	  0157	32				RETI
  187:
  188:				;------------------------------------------------------------------
  189:				;LCD Output.
  190:				;------------------------------------------------------------------
  191:	  0158	C0 07		LCDDELAY:	PUSH	07h
  192:	  015A	7F 00				MOV	R7,#00h
  193:	  015C	DF FE				DJNZ	R7,$
  194:	  015E	D0 07				POP	07h
  195:	  0160	22				RET
  196:
  197:				;A contains nibble, ACC.4 contains RS
  198:	  0161	D2 E5		LCDNIBOUT:	SETB	ACC.5				;E
  199:	  0163	F5 A0				MOV	P2,A
  200:	  0165	C2 A5				CLR	P2.5				;Negative edge on E
  201:	  0167	22				RET
  202:
  203:				;A contains byte
  204:	  0168	C0 E0		LCDCMDOUT:	PUSH	ACC
  205:	  016A	C4				SWAP	A				;High nibble first
  206:	  016B	54 0F				ANL	A,#0Fh
  207:	  016D	31 61				ACALL	LCDNIBOUT
  208:	  016F	D0 E0				POP	ACC
  209:	  0171	54 0F				ANL	A,#0Fh
  210:	  0173	31 61				ACALL	LCDNIBOUT
  211:	  0175	31 58				ACALL	LCDDELAY			;Wait for BF to clear

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:	  0177	22				RET
  213:
  214:				;A contains byte
  215:	  0178	C0 E0		LCDCHROUT:	PUSH	ACC
  216:	  017A	C4				SWAP	A				;High nibble first
  217:	  017B	54 0F				ANL	A,#0Fh
  218:	  017D	D2 E4				SETB	ACC.4				;RS
  219:	  017F	31 61				ACALL	LCDNIBOUT
  220:	  0181	D0 E0				POP	ACC
  221:	  0183	54 0F				ANL	A,#0Fh
  222:	  0185	D2 E4				SETB	ACC.4				;RS
  223:	  0187	31 61				ACALL	LCDNIBOUT
  224:	  0189	31 58				ACALL	LCDDELAY			;Wait for BF to clear
  225:	  018B	22				RET
  226:
  227:	  018C	74 01		LCDCLEAR:	MOV	A,#00000001b
  228:	  018E	31 68				ACALL	LCDCMDOUT
  229:	  0190	7F 00				MOV	R7,#00h
  230:	  0192	31 58		LCDCLEAR1:	ACALL	LCDDELAY
  231:	  0194	DF FC				DJNZ	R7,LCDCLEAR1
  232:	  0196	22				RET
  233:
  234:				;A contais address
  235:	  0197	44 80		LCDSETADR:	ORL	A,#10000000b
  236:	  0199	31 68				ACALL	LCDCMDOUT
  237:	  019B	22				RET
  238:
  239:	  019C	E6		LCDPRINTSTR:	MOV	A,@R0
  240:	  019D	31 78				ACALL	LCDCHROUT
  241:	  019F	08				INC	R0
  242:	  01A0	DD FA				DJNZ	R5,LCDPRINTSTR
  243:	  01A2	22				RET
  244:
  245:	  01A3	74 03		LCDINIT:	MOV	A,#00000011b			;Function set
  246:	  01A5	31 61				ACALL	LCDNIBOUT
  247:	  01A7	31 58				ACALL	LCDDELAY			;Wait for BF to clear
  248:	  01A9	74 28				MOV	A,#00101000b
  249:	  01AB	31 68				ACALL	LCDCMDOUT
  250:	  01AD	74 28				MOV	A,#00101000b
  251:	  01AF	31 68				ACALL	LCDCMDOUT
  252:	  01B1	74 0C				MOV	A,#00001100b			;Display ON/OFF
  253:	  01B3	31 68				ACALL	LCDCMDOUT
  254:	  01B5	31 8C				ACALL	LCDCLEAR			;Clear
  255:	  01B7	74 06				MOV	A,#00000110b			;Cursor direction
  256:	  01B9	31 68				ACALL	LCDCMDOUT
  257:	  01BB	22				RET
  258:
  259:	  01BC	78 40		LCDCLEARBUFF:	MOV	R0,#LCDBUFF
  260:	  01BE	7F 10				MOV	R7,#10h
  261:	  01C0	74 20				MOV	A,#20H
  262:	  01C2	F6		LCDCLEARBUFF1:	MOV	@R0,A
  263:	  01C3	08				INC	R0
  264:	  01C4	DF FC				DJNZ	R7,LCDCLEARBUFF1
  265:	  01C6	22				RET
  266:						END


ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6







                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
CLOCKBLINKFLAG			  BIT	      02	   6
CLOCKFLAG			  BIT	      00	   4
CLOCKINC			  CODE	    007F	  66
CLOCKINCEX			  CODE	    009D	  84
CLOCKINT			  CODE	    010F	 149
CLOCKINTEX			  CODE	    011C	 155
CLOCKSET			  CODE	    005A	  52
CLOCKSET1			  CODE	    005F	  54
CLOCKSET2			  CODE	    0062	  55
CLOCKSET3			  CODE	    0068	  57
CLOCKSET4			  CODE	    006B	  58
CLOCKSET5			  CODE	    0071	  60
CLOCKSET6			  CODE	    0074	  61
CLOCKSET7			  CODE	    007A	  63
CLOCKSETFLAG			  BIT	      01	   5
CLOCKSETINT			  CODE	    011D	 156
CLOCKSETINT1			  CODE	    013B	 171
CLOCKSETINT2			  CODE	    0148	 178
CLOCKSETINTEX			  CODE	    0155	 185
CLOCKSETSEL			  NUMBER    0050	   7
CLOCKSHOW			  CODE	    009E	  86
CLOCKSHOW1			  CODE	    00B4	  97
CLOCKSHOW2			  CODE	    00C3	 105
CLOCKSHOW3			  CODE	    00D6	 116
CLOCKSHOW4			  CODE	    00E5	 124
CLOCKSHOW5			  CODE	    00F8	 135
CLOCKSHOW6			  CODE	    0107	 143
CY				  BIT	      D7
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
IT0				  BIT	      88
IT1				  BIT	      8A
LCDBUFF				  NUMBER    0040	   3
LCDCHROUT			  CODE	    0178	 215
LCDCLEAR			  CODE	    018C	 227
LCDCLEAR1			  CODE	    0192	 230
LCDCLEARBUFF			  CODE	    01BC	 259
LCDCLEARBUFF1			  CODE	    01C2	 262
LCDCMDOUT			  CODE	    0168	 204
LCDDELAY			  CODE	    0158	 191
LCDINIT				  CODE	    01A3	 245
LCDNIBOUT			  CODE	    0161	 198
LCDPRINTSTR			  CODE	    019C	 239
LCDSETADR			  CODE	    0197	 235
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PCON				  DATA	      87
PS				  BIT	      BC
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SBUF				  DATA	      99
SCON				  DATA	      98
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
START				  CODE	    002C	  32
START1				  CODE	    0047	  43
START2				  CODE	    004C	  45
START3				  CODE	    0058	  50
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
WR				  BIT	      B6
