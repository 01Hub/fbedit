
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	Calc.a51
	Object File:	Calc.hex
	List File:	Calc.lst



 Line  I  Addr  Code            Source

    1:
    2:		N      0040	LCDBUFF		equ	40h		;40h-4Fh 16 byte buffer
    3:
    4:				;RESET:***********************************************
    5:		N      0000			ORG	0000h
    6:	  0000	02 00 2C			LJMP	START		;RESET:
    7:				;IE0IRQ:**********************************************
    8:		N      0003			ORG	0003h
    9:	  0003	32				RETI			;IE0IRQ:
   10:				;TF0IRQ:**********************************************
   11:		N      000B			ORG	000Bh
   12:	  000B	32				RETI			;TF0IRQ:
   13:				;IE1IRQ:**********************************************
   14:		N      0013			ORG	0013h
   15:	  0013	32				RETI			;IE1IRQ:
   16:				;TF1IRQ:**********************************************
   17:		N      001B			ORG	001Bh
   18:	  001B	32				RETI			;TF1IRQ:
   19:				;RITIIRQ:*********************************************
   20:		N      0023			ORG	0023h
   21:	  0023	32				RETI			;RITIIRQ:
   22:				;TF2EXF2IRQ:******************************************
   23:		N      002B			ORG	002Bh
   24:	  002B	32				RETI			;TF2EXF2IRQ:
   25:				;*****************************************************
   26:
   27:	  002C	31 09		START:		ACALL	LCDCLEARBUFF
   28:	  002E	11 F0				ACALL	LCDINIT
   29:	  0030	11 D9				ACALL	LCDCLEAR
   30:	  0032	75 4F 30			MOV	4Fh,#'0'
   31:	  0035	11 60				ACALL	LCDSHOW
   32:	  0037	11 6A		START1:		ACALL	SCANKEYBOARD
   33:	  0039	60 FC				JZ	START1
   34:	  003B	B4 43 09			CJNE	A,#'C',START2
   35:	  003E	31 09				ACALL	LCDCLEARBUFF
   36:	  0040	75 4F 30			MOV	4Fh,#'0'
   37:	  0043	11 60				ACALL	LCDSHOW
   38:	  0045	80 F0				SJMP	START1
   39:	  0047	C0 E0		START2:		PUSH	ACC
   40:	  0049	78 40				MOV	R0,#LCDBUFF
   41:	  004B	79 41				MOV	R1,#LCDBUFF+1
   42:	  004D	7F 0F				MOV	R7,#15
   43:	  004F	E7		START3:		MOV	A,@R1

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  0050	F6				MOV	@R0,A
   45:	  0051	08				INC	R0
   46:	  0052	09				INC	R1
   47:	  0053	DF FA				DJNZ	R7,START3
   48:	  0055	D0 E0				POP	ACC
   49:	  0057	F6				MOV	@R0,A
   50:	  0058	11 60				ACALL	LCDSHOW
   51:	  005A	11 6A		START4:		ACALL	SCANKEYBOARD
   52:	  005C	70 FC				JNZ	START4
   53:	  005E	80 D7				SJMP	START1
   54:
   55:	  0060	E4		LCDSHOW:	CLR	A
   56:	  0061	11 E4				ACALL	LCDSETADR
   57:	  0063	7F 10				MOV	R7,#16
   58:	  0065	78 40				MOV	R0,#LCDBUFF
   59:	  0067	11 E9				ACALL	LCDPRINTSTR
   60:	  0069	22				RET
   61:
   62:	  006A	7F 04		SCANKEYBOARD:	MOV	R7,#04h
   63:	  006C	7E FE				MOV	R6,#0FEh
   64:	  006E	8E 90		SCANKEYBOARD1:	MOV	P1,R6
   65:	  0070	E5 90				MOV	A,P1
   66:	  0072	54 F0				ANL	A,#0F0h
   67:	  0074	B4 F0 08			CJNE	A,#0F0h,SCANKEYBOARD2
   68:	  0077	EE				MOV	A,R6
   69:	  0078	D3				SETB	C
   70:	  0079	33				RLC	A
   71:	  007A	FE				MOV	R6,A
   72:	  007B	DF F1				DJNZ	R7,SCANKEYBOARD1
   73:						;No keys down
   74:	  007D	E4				CLR	A
   75:	  007E	22				RET
   76:	  007F	7D 04		SCANKEYBOARD2:	MOV	R5,#04h
   77:	  0081	1D		SCANKEYBOARD3:	DEC	R5		;Row
   78:	  0082	33				RLC	A
   79:	  0083	40 FC				JC	SCANKEYBOARD3
   80:	  0085	EE				MOV	A,R6
   81:	  0086	7E FF				MOV	R6,#0FFh	;Column
   82:	  0088	0E		SCANKEYBOARD4:	INC	R6
   83:	  0089	13				RRC	A
   84:	  008A	40 FC				JC	SCANKEYBOARD4
   85:	  008C	ED				MOV	A,R5
   86:	  008D	23				RL	A
   87:	  008E	23				RL	A
   88:	  008F	4E				ORL	A,R6
   89:	  0090	90 00 95			MOV	DPTR,#KEYS
   90:	  0093	93				MOVC	A,@A+DPTR
   91:	  0094	22				RET
   92:
   93:	  0095	37 38 39 2B	KEYS:		DB	'789+'
   94:	  0099	34 35 36 2D			DB	'456-'
   95:	  009D	31 32 33 2A			DB	'123*'
   96:	  00A1	43 30 2E 2F			DB	'C0./'
   97:
   98:				;------------------------------------------------------------------
   99:				;LCD Output.

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:				;------------------------------------------------------------------
  101:	  00A5	C0 07		LCDDELAY:	PUSH	07h
  102:	  00A7	7F 00				MOV	R7,#00h
  103:	  00A9	DF FE				DJNZ	R7,$
  104:	  00AB	D0 07				POP	07h
  105:	  00AD	22				RET
  106:
  107:				;A contains nibble, ACC.4 contains RS
  108:	  00AE	D2 E5		LCDNIBOUT:	SETB	ACC.5				;E
  109:	  00B0	F5 A0				MOV	P2,A
  110:	  00B2	C2 A5				CLR	P2.5				;Negative edge on E
  111:	  00B4	22				RET
  112:
  113:				;A contains byte
  114:	  00B5	C0 E0		LCDCMDOUT:	PUSH	ACC
  115:	  00B7	C4				SWAP	A				;High nibble first
  116:	  00B8	54 0F				ANL	A,#0Fh
  117:	  00BA	11 AE				ACALL	LCDNIBOUT
  118:	  00BC	D0 E0				POP	ACC
  119:	  00BE	54 0F				ANL	A,#0Fh
  120:	  00C0	11 AE				ACALL	LCDNIBOUT
  121:	  00C2	11 A5				ACALL	LCDDELAY			;Wait for BF to clear
  122:	  00C4	22				RET
  123:
  124:				;A contains byte
  125:	  00C5	C0 E0		LCDCHROUT:	PUSH	ACC
  126:	  00C7	C4				SWAP	A				;High nibble first
  127:	  00C8	54 0F				ANL	A,#0Fh
  128:	  00CA	D2 E4				SETB	ACC.4				;RS
  129:	  00CC	11 AE				ACALL	LCDNIBOUT
  130:	  00CE	D0 E0				POP	ACC
  131:	  00D0	54 0F				ANL	A,#0Fh
  132:	  00D2	D2 E4				SETB	ACC.4				;RS
  133:	  00D4	11 AE				ACALL	LCDNIBOUT
  134:	  00D6	11 A5				ACALL	LCDDELAY			;Wait for BF to clear
  135:	  00D8	22				RET
  136:
  137:	  00D9	74 01		LCDCLEAR:	MOV	A,#00000001b
  138:	  00DB	11 B5				ACALL	LCDCMDOUT
  139:	  00DD	7F 00				MOV	R7,#00h
  140:	  00DF	11 A5		LCDCLEAR1:	ACALL	LCDDELAY
  141:	  00E1	DF FC				DJNZ	R7,LCDCLEAR1
  142:	  00E3	22				RET
  143:
  144:				;A contais address
  145:	  00E4	44 80		LCDSETADR:	ORL	A,#10000000b
  146:	  00E6	11 B5				ACALL	LCDCMDOUT
  147:	  00E8	22				RET
  148:
  149:	  00E9	E6		LCDPRINTSTR:	MOV	A,@R0
  150:	  00EA	11 C5				ACALL	LCDCHROUT
  151:	  00EC	08				INC	R0
  152:	  00ED	DF FA				DJNZ	R7,LCDPRINTSTR
  153:	  00EF	22				RET
  154:
  155:	  00F0	74 03		LCDINIT:	MOV	A,#00000011b			;Function set

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  00F2	11 AE				ACALL	LCDNIBOUT
  157:	  00F4	11 A5				ACALL	LCDDELAY			;Wait for BF to clear
  158:	  00F6	74 28				MOV	A,#00101000b
  159:	  00F8	11 B5				ACALL	LCDCMDOUT
  160:	  00FA	74 28				MOV	A,#00101000b
  161:	  00FC	11 B5				ACALL	LCDCMDOUT
  162:	  00FE	74 0C				MOV	A,#00001100b			;Display ON/OFF
  163:	  0100	11 B5				ACALL	LCDCMDOUT
  164:	  0102	11 D9				ACALL	LCDCLEAR			;Clear
  165:	  0104	74 06				MOV	A,#00000110b			;Cursor direction
  166:	  0106	11 B5				ACALL	LCDCMDOUT
  167:	  0108	22				RET
  168:
  169:	  0109	78 40		LCDCLEARBUFF:	MOV	R0,#LCDBUFF
  170:	  010B	7F 10				MOV	R7,#10h
  171:	  010D	74 20				MOV	A,#20H
  172:	  010F	F6		LCDCLEARBUFF1:	MOV	@R0,A
  173:	  0110	08				INC	R0
  174:	  0111	DF FC				DJNZ	R7,LCDCLEARBUFF1
  175:	  0113	22				RET
  176:
  177:						END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
CY				  BIT	      D7
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
IT0				  BIT	      88
IT1				  BIT	      8A
KEYS				  CODE	    0095	  93
LCDBUFF				  NUMBER    0040	   2
LCDCHROUT			  CODE	    00C5	 125
LCDCLEAR			  CODE	    00D9	 137
LCDCLEAR1			  CODE	    00DF	 140
LCDCLEARBUFF			  CODE	    0109	 169
LCDCLEARBUFF1			  CODE	    010F	 172
LCDCMDOUT			  CODE	    00B5	 114
LCDDELAY			  CODE	    00A5	 101
LCDINIT				  CODE	    00F0	 155
LCDNIBOUT			  CODE	    00AE	 108
LCDPRINTSTR			  CODE	    00E9	 149
LCDSETADR			  CODE	    00E4	 145
LCDSHOW				  CODE	    0060	  55
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PCON				  DATA	      87
PS				  BIT	      BC
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PX0				  BIT	      B8
PX1				  BIT	      BA
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SBUF				  DATA	      99
SCANKEYBOARD			  CODE	    006A	  62
SCANKEYBOARD1			  CODE	    006E	  64
SCANKEYBOARD2			  CODE	    007F	  76
SCANKEYBOARD3			  CODE	    0081	  77
SCANKEYBOARD4			  CODE	    0088	  82
SCON				  DATA	      98
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
START				  CODE	    002C	  27
START1				  CODE	    0037	  32
START2				  CODE	    0047	  39
START3				  CODE	    004F	  43
START4				  CODE	    005A	  51
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
WR				  BIT	      B6
