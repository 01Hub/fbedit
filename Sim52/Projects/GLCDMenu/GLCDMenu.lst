
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	GLCDMenu.a51
	Object File:	GLCDMenu.hex
	List File:	GLCDMenu.lst



 Line  I  Addr  Code            Source

    1:
    2:				; The processor clock speed is 24MHz.
    3:				; Cycle time is .500uS.
    4:				; Demo software to display a bit-mapped
    5:				; graphic on a 240x128 graphics display
    6:				; with a T6963C LCD controller.
    7:
    8:		B	 90	PB_CD		BIT	P1.0
    9:		B	 91	PB_R		BIT	P1.1
   10:		B	 92	PB_W		BIT	P1.2
   11:		B	 93	PB_RST		BIT	P1.3
   12:		D      00A0	P_DATA		EQU	P2
   13:		N      001E	CHARSLINE	EQU	30
   14:
   15:		N      0000			ORG	0000h
   16:	  0000	02 01 00			LJMP	START		;program start
   17:
   18:		N      0100			ORG	0100h
   19:	  0100			START:
   20:						; Initialize the T6963C
   21:	  0100	C2 93				CLR	PB_RST		;hardware reset
   22:	  0102	00				NOP
   23:	  0103	00				NOP
   24:	  0104	00				NOP
   25:	  0105	00				NOP
   26:	  0106	D2 93				SETB	PB_RST
   27:	  0108	90 01 C8			MOV	DPTR,#MSGINIT	;initialization bytes
   28:	  010B	31 30				ACALL	SENDCOMMANDS
   29:	  010D	31 46				ACALL	CLS
   30:	  010F	31 5B				ACALL	SETCGRAM
   31:	  0111	90 02 1C			MOV	DPTR,#MENU1
   32:	  0114	7E 00				MOV	R6,#00h
   33:	  0116	7F 00				MOV	R7,#00h
   34:	  0118	31 1C				ACALL	PRINTMENU
   35:	  011A	80 FE				SJMP	$
   36:
   37:	  011C			PRINTMENU:
   38:	  011C	E4				CLR	A
   39:	  011D	93				MOVC	A,@A+DPTR	;get byte
   40:	  011E	04				INC	A
   41:	  011F	60 0E				JZ	PRINTMENUEX
   42:	  0121	14				DEC	A
   43:	  0122	C0 06				PUSH	6

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  0124	C0 07				PUSH	7
   45:	  0126	31 71				ACALL	PRINTLINE
   46:	  0128	D0 07				POP	7
   47:	  012A	D0 06				POP	6
   48:	  012C	0F				INC	R7
   49:	  012D	80 ED				SJMP	PRINTMENU
   50:	  012F			PRINTMENUEX:
   51:	  012F	22				RET
   52:
   53:				;*************************************************
   54:
   55:				;Send bytes @DPTR as a series of commands, two data bytes and one command byte.
   56:				;Terminate if first data byte is 0FFh
   57:	  0130			SENDCOMMANDS:
   58:	  0130	E4				CLR	A
   59:	  0131	93				MOVC	A,@A+DPTR	;get byte
   60:	  0132	04				INC	A
   61:	  0133	60 10				JZ	SENDCOMMANDSEX
   62:	  0135	14				DEC	A
   63:	  0136	31 A6				ACALL	WRITEDATA
   64:	  0138	A3				INC	DPTR
   65:	  0139	E4				CLR	A
   66:	  013A	93				MOVC	A,@A+DPTR	;get byte
   67:	  013B	A3				INC	DPTR
   68:	  013C	31 A6				ACALL	WRITEDATA
   69:	  013E	E4				CLR	A
   70:	  013F	93				MOVC	A,@A+DPTR	;get byte
   71:	  0140	A3				INC	DPTR
   72:	  0141	31 9B				ACALL	WRITECOMMAND
   73:	  0143	80 EB				SJMP	SENDCOMMANDS
   74:	  0145			SENDCOMMANDSEX:
   75:	  0145	22				RET
   76:
   77:				;Clear 32K ram
   78:	  0146			CLS:
   79:	  0146	90 01 DE			MOV	DPTR,#MSGCLS	;Set ADP to 0000h and init auto write mode
   80:	  0149	31 30				ACALL	SENDCOMMANDS
   81:	  014B	7F 80				MOV	R7,#80h
   82:	  014D	7E 00				MOV	R6,#00h
   83:	  014F			CLS1:
   84:	  014F	E4				CLR	A
   85:	  0150	31 A6				ACALL	WRITEDATA
   86:	  0152	DE FB				DJNZ	R6,CLS1
   87:	  0154	DF F9				DJNZ	R7,CLS1
   88:	  0156	74 B2				MOV	A,#0B2h		;Auto Reset
   89:	  0158	31 9B				ACALL	WRITECOMMAND
   90:	  015A	22				RET
   91:
   92:	  015B			SETCGRAM:
   93:	  015B	90 01 E5			MOV	DPTR,#MSGCGRAM	;Set ADP to 2400h and init auto write mode
   94:	  015E	31 30				ACALL	SENDCOMMANDS
   95:	  0160	90 01 EC			MOV	DPTR,#CGRAM
   96:	  0163	7F 30				MOV	R7,#8*6		;6 characters to be defined
   97:	  0165			SETCGRAM1:
   98:	  0165	E4				CLR	A
   99:	  0166	93				MOVC	A,@A+DPTR	;get byte

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:	  0167	A3				INC	DPTR
  101:	  0168	31 A6				ACALL	WRITEDATA
  102:	  016A	DF F9				DJNZ	R7,SETCGRAM1
  103:	  016C	74 B2				MOV	A,#0B2h		;Auto Reset
  104:	  016E	31 9B				ACALL	WRITECOMMAND
  105:	  0170	22				RET
  106:
  107:				;Line data @DPTR,R6 pos, R7 line
  108:	  0171			PRINTLINE:
  109:	  0171	75 F0 1E			MOV	B,#CHARSLINE	;Number of characters on each line
  110:	  0174	EF				MOV	A,R7
  111:	  0175	A4				MUL	AB
  112:	  0176	2E				ADD	A,R6
  113:	  0177	FE				MOV	R6,A
  114:	  0178	E5 F0				MOV	A,B
  115:	  017A	34 10				ADDC	A,#10h		;Add start of text address
  116:	  017C	FF				MOV	R7,A
  117:	  017D	EE				MOV	A,R6		;ADP LSB
  118:	  017E	31 A6				ACALL	WRITEDATA
  119:	  0180	EF				MOV	A,R7		;ADP MSB
  120:	  0181	31 A6				ACALL	WRITEDATA
  121:	  0183	74 24				MOV	A,#24h		;Set address pointer command
  122:	  0185	31 9B				ACALL	WRITECOMMAND
  123:	  0187	74 B0				MOV	A,#0B0h		;Set auto write mode
  124:	  0189	31 9B				ACALL	WRITECOMMAND
  125:	  018B			PRINTLINE1:
  126:	  018B	E4				CLR	A
  127:	  018C	93				MOVC	A,@A+DPTR	;get byte
  128:	  018D	A3				INC	DPTR
  129:	  018E	04				INC	A
  130:	  018F	60 05				JZ	PRINTLINEEX
  131:	  0191	14				DEC	A
  132:	  0192	31 A6				ACALL	WRITEDATA
  133:	  0194	80 F5				SJMP	PRINTLINE1
  134:	  0196			PRINTLINEEX:
  135:	  0196	74 B2				MOV	A,#0B2h		;Auto Reset
  136:	  0198	31 9B				ACALL	WRITECOMMAND
  137:	  019A	22				RET
  138:
  139:				; WRITECOMMAND sends the byte in A to a
  140:				; graphics module as a command.
  141:	  019B			WRITECOMMAND:
  142:	  019B	31 B1				ACALL	STATUS		;display ready?
  143:	  019D	D2 90				SETB	PB_CD		;c/d = 1
  144:	  019F	F5 A0				MOV	P_DATA,A	;set data
  145:	  01A1	C2 92				CLR	PB_W		;strobe it
  146:	  01A3	D2 92				SETB	PB_W
  147:	  01A5	22				RET
  148:
  149:				; WRITEDATA sends the byte in A to the
  150:				; graphics module as data.
  151:	  01A6			WRITEDATA:
  152:	  01A6	31 B1				ACALL	STATUS		;display ready?
  153:	  01A8	C2 90				CLR	PB_CD		;c/d = 0
  154:	  01AA	F5 A0				MOV	P_DATA,A	;set data
  155:	  01AC	C2 92				CLR	PB_W		;strobe it

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  01AE	D2 92				SETB	PB_W
  157:	  01B0	22				RET
  158:
  159:				; STATUS check to see that the graphic
  160:				; display is ready. It won't return
  161:				; until it is.
  162:	  01B1			STATUS:
  163:	  01B1	C0 E0				PUSH	ACC
  164:	  01B3	D2 90				SETB	PB_CD		;c/d=1
  165:	  01B5	75 A0 FF			MOV	P_DATA,#0FFh	;Port to input
  166:	  01B8	7B 0B				MOV	R3,#0Bh		;status bits mask
  167:	  01BA			STATUS1:
  168:	  01BA	C2 91				CLR	PB_R		;read it
  169:	  01BC	E5 A0				MOV	A,P_DATA
  170:	  01BE	D2 91				SETB	PB_R
  171:	  01C0	5B				ANL	A,R3		;status OK?
  172:	  01C1	C3				CLR	C
  173:	  01C2	9B				SUBB	A,R3
  174:	  01C3	70 F5				JNZ	STATUS1
  175:	  01C5	D0 E0				POP	ACC
  176:	  01C7	22				RET
  177:
  178:				; Initialization bytes for 240x128
  179:	  01C8			MSGINIT:
  180:	  01C8	00 10 40			DB	00h,10h,40h	;text home address
  181:	  01CB	1E 00 41			DB	1Eh,00h,41h	;text area
  182:	  01CE	00 00 42			DB	00h,00h,42h	;graphic home address
  183:	  01D1	1E 00 43			DB	1Eh,00h,43h	;graphic area
  184:	  01D4	00 00 84			DB	00h,00h,84h	;mode set. Text Attribute mode
  185:	  01D7	04 00 22			DB	04h,00h,22h	;offset register set, CG RAM area at 2000h to 27FFh
  186:	  01DA	00 00 94			DB	00h,00h,94h	;display mode set. Text on, Graphic off, Cursor off, Blink o
				ff
  187:	  01DD	FF				DB	0FFh
  188:
  189:	  01DE			MSGCLS:
  190:	  01DE	00 00 24			DB	00h,00h,24h	;address pointer set
  191:	  01E1	00 00 B0			DB	00h,00h,0B0h	;auto write mode
  192:	  01E4	FF				DB	0FFh
  193:
  194:	  01E5			MSGCGRAM:
  195:	  01E5	00 24 24			DB	00h,24h,24h	;CG RAM address pointer set, character code 80h to 85h
  196:	  01E8	00 00 B0			DB	00h,00h,0B0h	;auto write mode
  197:	  01EB	FF				DB	0FFh
  198:
  199:	  01EC			CGRAM:
  200:						;80h
  201:	  01EC	00				DB	000000b
  202:	  01ED	00				DB	000000b
  203:	  01EE	00				DB	000000b
  204:	  01EF	0F				DB	001111b
  205:	  01F0	0F				DB	001111b
  206:	  01F1	0C				DB	001100b
  207:	  01F2	0C				DB	001100b
  208:	  01F3	0C				DB	001100b
  209:						;81h
  210:	  01F4	00				DB	000000b

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  211:	  01F5	00				DB	000000b
  212:	  01F6	00				DB	000000b
  213:	  01F7	3F				DB	111111b
  214:	  01F8	3F				DB	111111b
  215:	  01F9	00				DB	000000b
  216:	  01FA	00				DB	000000b
  217:	  01FB	00				DB	000000b
  218:						;82h
  219:	  01FC	00				DB	000000b
  220:	  01FD	00				DB	000000b
  221:	  01FE	00				DB	000000b
  222:	  01FF	3C				DB	111100b
  223:	  0200	3C				DB	111100b
  224:	  0201	0C				DB	001100b
  225:	  0202	0C				DB	001100b
  226:	  0203	0C				DB	001100b
  227:						;83h
  228:	  0204	0C				DB	001100b
  229:	  0205	0C				DB	001100b
  230:	  0206	0C				DB	001100b
  231:	  0207	0C				DB	001100b
  232:	  0208	0C				DB	001100b
  233:	  0209	0C				DB	001100b
  234:	  020A	0C				DB	001100b
  235:	  020B	0C				DB	001100b
  236:						;84h
  237:	  020C	0C				DB	001100b
  238:	  020D	0C				DB	001100b
  239:	  020E	0C				DB	001100b
  240:	  020F	3C				DB	111100b
  241:	  0210	3C				DB	111100b
  242:	  0211	00				DB	000000b
  243:	  0212	00				DB	000000b
  244:	  0213	00				DB	000000b
  245:						;85h
  246:	  0214	0C				DB	001100b
  247:	  0215	0C				DB	001100b
  248:	  0216	0C				DB	001100b
  249:	  0217	0F				DB	001111b
  250:	  0218	0F				DB	001111b
  251:	  0219	00				DB	000000b
  252:	  021A	00				DB	000000b
  253:	  021B	00				DB	000000b
  254:
  255:	  021C	24 45 56 49	MENU1:		DB	024h,045h,056h,049h,043h,045h,000h,050h,052h,04Fh,047h,052h,041h,04Dh,04Dh,0
	  0220	43 45 00 50	45h,052h,0FFh
	  0224	52 4F 47 52
	  0228	41 4D 4D 45
	  022C	52 FF
  256:	  022E	80 81 81 81			DB	080h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,0
	  0232	81 81 81 81	81h,082h,0FFh
	  0236	81 81 81 81
	  023A	81 81 81 81
	  023E	82 FF
  257:	  0240	83 21 00 00			DB	083h,021h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  0244	00 00 00 00	00h,083h,0FFh

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

	  0248	00 00 00 00
	  024C	00 00 00 00
	  0250	83 FF
  258:	  0252	83 22 00 00			DB	083h,022h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  0256	00 00 00 00	00h,083h,0FFh
	  025A	00 00 00 00
	  025E	00 00 00 00
	  0262	83 FF
  259:	  0264	83 23 00 00			DB	083h,023h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  0268	00 00 00 00	00h,083h,0FFh
	  026C	00 00 00 00
	  0270	00 00 00 00
	  0274	83 FF
  260:	  0276	83 00 00 00			DB	083h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  027A	00 00 00 00	00h,083h,0FFh
	  027E	00 00 00 00
	  0282	00 00 00 00
	  0286	83 FF
  261:	  0288	83 00 00 00			DB	083h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  028C	00 00 00 00	00h,083h,0FFh
	  0290	00 00 00 00
	  0294	00 00 00 00
	  0298	83 FF
  262:	  029A	85 81 81 81			DB	085h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,0
	  029E	81 81 81 81	81h,084h,0FFh
	  02A2	81 81 81 81
	  02A6	81 81 81 81
	  02AA	84 FF
  263:	  02AC	FF				DB	0FFh
  264:
  265:						END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
CGRAM				  CODE	    01EC	 199
CHARSLINE			  NUMBER    001E	  13
CLS				  CODE	    0146	  78
CLS1				  CODE	    014F	  83
CY				  BIT	      D7
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
IT0				  BIT	      88
IT1				  BIT	      8A
MENU1				  CODE	    021C	 255
MSGCGRAM			  CODE	    01E5	 194
MSGCLS				  CODE	    01DE	 189
MSGINIT				  CODE	    01C8	 179
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PB_CD				  BIT	      90	   8
PB_R				  BIT	      91	   9
PB_RST				  BIT	      93	  11
PB_W				  BIT	      92	  10
PCON				  DATA	      87
PRINTLINE			  CODE	    0171	 108
PRINTLINE1			  CODE	    018B	 125
PRINTLINEEX			  CODE	    0196	 134
PRINTMENU			  CODE	    011C	  37
PRINTMENUEX			  CODE	    012F	  50
PS				  BIT	      BC

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
P_DATA				  NUMBER    00A0	  12
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SBUF				  DATA	      99
SCON				  DATA	      98
SENDCOMMANDS			  CODE	    0130	  57
SENDCOMMANDSEX			  CODE	    0145	  74
SETCGRAM			  CODE	    015B	  92
SETCGRAM1			  CODE	    0165	  97
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
START				  CODE	    0100	  19
STATUS				  CODE	    01B1	 162
STATUS1				  CODE	    01BA	 167
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
WR				  BIT	      B6
WRITECOMMAND			  CODE	    019B	 141
WRITEDATA			  CODE	    01A6	 151
