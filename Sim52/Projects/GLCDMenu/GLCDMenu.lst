
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	GLCDMenu.a51
	Object File:	GLCDMenu.hex
	List File:	GLCDMenu.lst



 Line  I  Addr  Code            Source

    1:
    2:				; The processor clock speed is 24MHz.
    3:				; Cycle time is .500uS.
    4:				; Demo software to display a bit-mapped
    5:				; graphic on a 240x128 graphics display
    6:				; with a T6963C LCD controller.
    7:
    8:		B	 90	PB_CD		BIT	P1.0
    9:		B	 91	PB_R		BIT	P1.1
   10:		B	 92	PB_W		BIT	P1.2
   11:		B	 93	PB_RST		BIT	P1.3
   12:		D      00A0	P_DATA		EQU	P2
   13:		N      001E	CHARSLINE	EQU	30
   14:		N      0000	GRPHOME		EQU	0000h
   15:		N      1000	TXTHOME		EQU	1000h
   16:		N      2000	CGRHOME		EQU	2000h
   17:		N      0040	LASTMNUSELX	EQU	40h
   18:		N      0040	LASTMNUSELY	EQU	40h
   19:
   20:		N      0000			ORG	0000h
   21:	  0000	02 01 00			LJMP	START		;program start
   22:
   23:		N      0100			ORG	0100h
   24:
   25:	  0100			START:		; Initialize the T6963C
   26:	  0100	C2 93				CLR	PB_RST		;hardware reset
   27:	  0102	00				NOP
   28:	  0103	00				NOP
   29:	  0104	00				NOP
   30:	  0105	00				NOP
   31:	  0106	D2 93				SETB	PB_RST
   32:	  0108	90 02 1D			MOV	DPTR,#MSGINIT	;initialization bytes
   33:	  010B	31 54				ACALL	SENDCOMMANDS
   34:	  010D	31 6A				ACALL	CLS
   35:	  010F	31 7F				ACALL	SETCGRAM
   36:	  0111	90 02 71			MOV	DPTR,#MENU1
   37:	  0114	7E 00				MOV	R6,#00h
   38:	  0116	7F 00				MOV	R7,#00h
   39:	  0118	31 24				ACALL	PRINTMENU
   40:	  011A	7D 0F				MOV	R5,#15
   41:	  011C	7E 01				MOV	R6,#1
   42:	  011E	7F 02				MOV	R7,#2
   43:	  0120	31 38				ACALL	SELECTMENU

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  0122	80 FE				SJMP	$
   45:
   46:	  0124	E4		PRINTMENU:	CLR	A
   47:	  0125	93				MOVC	A,@A+DPTR	;get byte
   48:	  0126	04				INC	A
   49:	  0127	60 0E				JZ	PRINTMENUEX
   50:	  0129	14				DEC	A
   51:	  012A	C0 06				PUSH	6
   52:	  012C	C0 07				PUSH	7
   53:	  012E	31 A2				ACALL	PRINTLINE
   54:	  0130	D0 07				POP	7
   55:	  0132	D0 06				POP	6
   56:	  0134	0F				INC	R7
   57:	  0135	80 ED				SJMP	PRINTMENU
   58:	  0137	22		PRINTMENUEX:	RET
   59:
   60:	  0138	C0 05		SELECTMENU:	PUSH	5
   61:	  013A	C0 06				PUSH	6
   62:	  013C	C0 07				PUSH	7
   63:	  013E	AE 40				MOV	R6,LASTMNUSELX
   64:	  0140	AF 40				MOV	R7,LASTMNUSELY
   65:	  0142	E4				CLR	A
   66:	  0143	31 CA				ACALL	SETTEXTMODE
   67:	  0145	D0 07				POP	7
   68:	  0147	D0 06				POP	6
   69:	  0149	D0 05				POP	5
   70:	  014B	8E 40				MOV	LASTMNUSELX,R6
   71:	  014D	8F 40				MOV	LASTMNUSELY,R7
   72:	  014F	74 0D				MOV	A,#0Dh
   73:	  0151	31 CA				ACALL	SETTEXTMODE
   74:	  0153	22				RET
   75:
   76:				;*************************************************
   77:
   78:				;Send bytes @DPTR as a series of commands, two data bytes and one command byte.
   79:				;Terminate if first data byte is 0FFh
   80:	  0154	E4		SENDCOMMANDS:	CLR	A
   81:	  0155	93				MOVC	A,@A+DPTR	;get byte
   82:	  0156	04				INC	A
   83:	  0157	60 10				JZ	SENDCOMMANDSEX
   84:	  0159	14				DEC	A
   85:	  015A	31 FB				ACALL	WRITEDATA
   86:	  015C	A3				INC	DPTR
   87:	  015D	E4				CLR	A
   88:	  015E	93				MOVC	A,@A+DPTR	;get byte
   89:	  015F	A3				INC	DPTR
   90:	  0160	31 FB				ACALL	WRITEDATA
   91:	  0162	E4				CLR	A
   92:	  0163	93				MOVC	A,@A+DPTR	;get byte
   93:	  0164	A3				INC	DPTR
   94:	  0165	31 F0				ACALL	WRITECOMMAND
   95:	  0167	80 EB				SJMP	SENDCOMMANDS
   96:	  0169	22		SENDCOMMANDSEX:	RET
   97:
   98:				;Clear 32K ram
   99:	  016A	90 02 33	CLS:		MOV	DPTR,#MSGCLS	;Set ADP to 0000h and init auto write mode

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:	  016D	31 54				ACALL	SENDCOMMANDS
  101:	  016F	7F 80				MOV	R7,#80h
  102:	  0171	7E 00				MOV	R6,#00h
  103:	  0173	E4		CLS1:		CLR	A
  104:	  0174	31 FB				ACALL	WRITEDATA
  105:	  0176	DE FB				DJNZ	R6,CLS1
  106:	  0178	DF F9				DJNZ	R7,CLS1
  107:	  017A	74 B2				MOV	A,#0B2h		;Auto Reset
  108:	  017C	31 F0				ACALL	WRITECOMMAND
  109:	  017E	22				RET
  110:
  111:	  017F	90 02 3A	SETCGRAM:	MOV	DPTR,#MSGCGRAM	;Set ADP to 2400h and init auto write mode
  112:	  0182	31 54				ACALL	SENDCOMMANDS
  113:	  0184	90 02 41			MOV	DPTR,#CGRAM
  114:	  0187	7F 30				MOV	R7,#8*6		;6 characters to be defined
  115:	  0189	E4		SETCGRAM1:	CLR	A
  116:	  018A	93				MOVC	A,@A+DPTR	;get byte
  117:	  018B	A3				INC	DPTR
  118:	  018C	31 FB				ACALL	WRITEDATA
  119:	  018E	DF F9				DJNZ	R7,SETCGRAM1
  120:	  0190	74 B2				MOV	A,#0B2h		;Auto Reset
  121:	  0192	31 F0				ACALL	WRITECOMMAND
  122:	  0194	22				RET
  123:
  124:				;Convert text pos in R7:R6 to ram offset
  125:	  0195	75 F0 1E	POSTOADP:	MOV	B,#CHARSLINE	;Number of characters on each line
  126:	  0198	EF				MOV	A,R7
  127:	  0199	A4				MUL	AB
  128:	  019A	2E				ADD	A,R6
  129:	  019B	FE				MOV	R6,A
  130:	  019C	E5 F0				MOV	A,B
  131:	  019E	34 00				ADDC	A,#00h
  132:	  01A0	FF				MOV	R7,A
  133:	  01A1	22				RET
  134:
  135:				;Line data @DPTR,R6 pos, R7 line
  136:	  01A2	31 95		PRINTLINE:	ACALL	POSTOADP
  137:	  01A4	74 00				MOV	A,#LOW TXTHOME	;Add text home address
  138:	  01A6	2E				ADD	A,R6
  139:	  01A7	FE				MOV	R6,A
  140:	  01A8	74 10				MOV	A,#HIGH TXTHOME
  141:	  01AA	3F				ADDC	A,R7
  142:	  01AB	FF				MOV	R7,A
  143:	  01AC	EE				MOV	A,R6		;ADP LSB
  144:	  01AD	31 FB				ACALL	WRITEDATA
  145:	  01AF	EF				MOV	A,R7		;ADP MSB
  146:	  01B0	31 FB				ACALL	WRITEDATA
  147:	  01B2	74 24				MOV	A,#24h		;Set address pointer command
  148:	  01B4	31 F0				ACALL	WRITECOMMAND
  149:	  01B6	74 B0				MOV	A,#0B0h		;Set auto write mode
  150:	  01B8	31 F0				ACALL	WRITECOMMAND
  151:	  01BA	E4		PRINTLINE1:	CLR	A
  152:	  01BB	93				MOVC	A,@A+DPTR	;get byte
  153:	  01BC	A3				INC	DPTR
  154:	  01BD	04				INC	A
  155:	  01BE	60 05				JZ	PRINTLINEEX

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  01C0	14				DEC	A
  157:	  01C1	31 FB				ACALL	WRITEDATA
  158:	  01C3	80 F5				SJMP	PRINTLINE1
  159:	  01C5	74 B2		PRINTLINEEX:	MOV	A,#0B2h		;Auto Reset
  160:	  01C7	31 F0				ACALL	WRITECOMMAND
  161:	  01C9	22				RET
  162:
  163:				;R6 pos, R7 line, R5 number of characters, A mode
  164:	  01CA	C0 E0		SETTEXTMODE:	PUSH	ACC
  165:	  01CC	31 95				ACALL	POSTOADP
  166:	  01CE	74 00				MOV	A,#LOW GRPHOME	;Add text home address
  167:	  01D0	2E				ADD	A,R6
  168:	  01D1	FE				MOV	R6,A
  169:	  01D2	74 00				MOV	A,#HIGH GRPHOME
  170:	  01D4	3F				ADDC	A,R7
  171:	  01D5	FF				MOV	R7,A
  172:	  01D6	EE				MOV	A,R6		;ADP LSB
  173:	  01D7	31 FB				ACALL	WRITEDATA
  174:	  01D9	EF				MOV	A,R7		;ADP MSB
  175:	  01DA	31 FB				ACALL	WRITEDATA
  176:	  01DC	74 24				MOV	A,#24h		;Set address pointer command
  177:	  01DE	31 F0				ACALL	WRITECOMMAND
  178:	  01E0	74 B0				MOV	A,#0B0h		;Set auto write mode
  179:	  01E2	31 F0				ACALL	WRITECOMMAND
  180:	  01E4	D0 E0				POP	ACC
  181:	  01E6	31 FB		SETTEXTMODE1:	ACALL	WRITEDATA
  182:	  01E8	DD FC				DJNZ	R5,SETTEXTMODE1
  183:	  01EA	74 B2				MOV	A,#0B2h		;Auto Reset
  184:	  01EC	31 F0				ACALL	WRITECOMMAND
  185:	  01EE	22				RET
  186:	  01EF	22				RET
  187:
  188:				; WRITECOMMAND sends the byte in A to a
  189:				; graphics module as a command.
  190:	  01F0	51 06		WRITECOMMAND:	ACALL	STATUS		;display ready?
  191:	  01F2	D2 90				SETB	PB_CD		;c/d = 1
  192:	  01F4	F5 A0				MOV	P_DATA,A	;set data
  193:	  01F6	C2 92				CLR	PB_W		;strobe it
  194:	  01F8	D2 92				SETB	PB_W
  195:	  01FA	22				RET
  196:
  197:				; WRITEDATA sends the byte in A to the
  198:				; graphics module as data.
  199:	  01FB	51 06		WRITEDATA:	ACALL	STATUS		;display ready?
  200:	  01FD	C2 90				CLR	PB_CD		;c/d = 0
  201:	  01FF	F5 A0				MOV	P_DATA,A	;set data
  202:	  0201	C2 92				CLR	PB_W		;strobe it
  203:	  0203	D2 92				SETB	PB_W
  204:	  0205	22				RET
  205:
  206:				; STATUS check to see that the graphic
  207:				; display is ready. It won't return
  208:				; until it is.
  209:	  0206	C0 E0		STATUS:		PUSH	ACC
  210:	  0208	D2 90				SETB	PB_CD		;c/d=1
  211:	  020A	75 A0 FF			MOV	P_DATA,#0FFh	;Port to input

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:	  020D	7B 0B				MOV	R3,#0Bh		;status bits mask
  213:	  020F	C2 91		STATUS1:	CLR	PB_R		;read it
  214:	  0211	E5 A0				MOV	A,P_DATA
  215:	  0213	D2 91				SETB	PB_R
  216:	  0215	5B				ANL	A,R3		;status OK?
  217:	  0216	C3				CLR	C
  218:	  0217	9B				SUBB	A,R3
  219:	  0218	70 F5				JNZ	STATUS1
  220:	  021A	D0 E0				POP	ACC
  221:	  021C	22				RET
  222:
  223:				; Initialization bytes for 240x128
  224:	  021D	00 10 40	MSGINIT:	DB	00h,10h,40h	;text home address
  225:	  0220	1E 00 41			DB	1Eh,00h,41h	;text area
  226:	  0223	00 00 42			DB	00h,00h,42h	;graphic home address
  227:	  0226	1E 00 43			DB	1Eh,00h,43h	;graphic area
  228:	  0229	00 00 84			DB	00h,00h,84h	;mode set. Text Attribute mode
  229:	  022C	04 00 22			DB	04h,00h,22h	;offset register set, CG RAM area at 2000h to 27FFh
  230:	  022F	00 00 94			DB	00h,00h,94h	;display mode set. Text on, Graphic off, Cursor off, Blink o
				ff
  231:	  0232	FF				DB	0FFh
  232:
  233:	  0233	00 00 24	MSGCLS:		DB	00h,00h,24h	;address pointer set
  234:	  0236	00 00 B0			DB	00h,00h,0B0h	;auto write mode
  235:	  0239	FF				DB	0FFh
  236:
  237:	  023A	00 24 24	MSGCGRAM:	DB	00h,24h,24h	;CG RAM address pointer set, character code 80h to 85h
  238:	  023D	00 00 B0			DB	00h,00h,0B0h	;auto write mode
  239:	  0240	FF				DB	0FFh
  240:
  241:	  0241			CGRAM:		;80h
  242:	  0241	00				DB	000000b
  243:	  0242	00				DB	000000b
  244:	  0243	00				DB	000000b
  245:	  0244	0F				DB	001111b
  246:	  0245	0F				DB	001111b
  247:	  0246	0C				DB	001100b
  248:	  0247	0C				DB	001100b
  249:	  0248	0C				DB	001100b
  250:						;81h
  251:	  0249	00				DB	000000b
  252:	  024A	00				DB	000000b
  253:	  024B	00				DB	000000b
  254:	  024C	3F				DB	111111b
  255:	  024D	3F				DB	111111b
  256:	  024E	00				DB	000000b
  257:	  024F	00				DB	000000b
  258:	  0250	00				DB	000000b
  259:						;82h
  260:	  0251	00				DB	000000b
  261:	  0252	00				DB	000000b
  262:	  0253	00				DB	000000b
  263:	  0254	3C				DB	111100b
  264:	  0255	3C				DB	111100b
  265:	  0256	0C				DB	001100b
  266:	  0257	0C				DB	001100b

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  267:	  0258	0C				DB	001100b
  268:						;83h
  269:	  0259	0C				DB	001100b
  270:	  025A	0C				DB	001100b
  271:	  025B	0C				DB	001100b
  272:	  025C	0C				DB	001100b
  273:	  025D	0C				DB	001100b
  274:	  025E	0C				DB	001100b
  275:	  025F	0C				DB	001100b
  276:	  0260	0C				DB	001100b
  277:						;84h
  278:	  0261	0C				DB	001100b
  279:	  0262	0C				DB	001100b
  280:	  0263	0C				DB	001100b
  281:	  0264	3C				DB	111100b
  282:	  0265	3C				DB	111100b
  283:	  0266	00				DB	000000b
  284:	  0267	00				DB	000000b
  285:	  0268	00				DB	000000b
  286:						;85h
  287:	  0269	0C				DB	001100b
  288:	  026A	0C				DB	001100b
  289:	  026B	0C				DB	001100b
  290:	  026C	0F				DB	001111b
  291:	  026D	0F				DB	001111b
  292:	  026E	00				DB	000000b
  293:	  026F	00				DB	000000b
  294:	  0270	00				DB	000000b
  295:
  296:	  0271	24 45 56 49	MENU1:		DB	024h,045h,056h,049h,043h,045h,000h,050h,052h,04Fh,047h,052h,041h,04Dh,04Dh,0
	  0275	43 45 00 50	45h,052h,0FFh
	  0279	52 4F 47 52
	  027D	41 4D 4D 45
	  0281	52 FF
  297:	  0283	80 81 81 81			DB	080h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,0
	  0287	81 81 81 81	81h,082h,0FFh
	  028B	81 81 81 81
	  028F	81 81 81 81
	  0293	82 FF
  298:	  0295	83 21 00 00			DB	083h,021h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  0299	00 00 00 00	00h,083h,0FFh
	  029D	00 00 00 00
	  02A1	00 00 00 00
	  02A5	83 FF
  299:	  02A7	83 22 00 00			DB	083h,022h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  02AB	00 00 00 00	00h,083h,0FFh
	  02AF	00 00 00 00
	  02B3	00 00 00 00
	  02B7	83 FF
  300:	  02B9	83 23 00 00			DB	083h,023h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  02BD	00 00 00 00	00h,083h,0FFh
	  02C1	00 00 00 00
	  02C5	00 00 00 00
	  02C9	83 FF
  301:	  02CB	83 00 00 00			DB	083h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  02CF	00 00 00 00	00h,083h,0FFh

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

	  02D3	00 00 00 00
	  02D7	00 00 00 00
	  02DB	83 FF
  302:	  02DD	83 00 00 00			DB	083h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,000h,0
	  02E1	00 00 00 00	00h,083h,0FFh
	  02E5	00 00 00 00
	  02E9	00 00 00 00
	  02ED	83 FF
  303:	  02EF	85 81 81 81			DB	085h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,081h,0
	  02F3	81 81 81 81	81h,084h,0FFh
	  02F7	81 81 81 81
	  02FB	81 81 81 81
	  02FF	84 FF
  304:	  0301	FF				DB	0FFh
  305:
  306:						END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
CGRAM				  CODE	    0241	 241
CGRHOME				  NUMBER    2000	  16
CHARSLINE			  NUMBER    001E	  13
CLS				  CODE	    016A	  99
CLS1				  CODE	    0173	 103
CY				  BIT	      D7
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
GRPHOME				  NUMBER    0000	  14
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
IT0				  BIT	      88
IT1				  BIT	      8A
LASTMNUSELX			  NUMBER    0040	  17
LASTMNUSELY			  NUMBER    0040	  18
MENU1				  CODE	    0271	 296
MSGCGRAM			  CODE	    023A	 237
MSGCLS				  CODE	    0233	 233
MSGINIT				  CODE	    021D	 224
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PB_CD				  BIT	      90	   8
PB_R				  BIT	      91	   9
PB_RST				  BIT	      93	  11
PB_W				  BIT	      92	  10
PCON				  DATA	      87
POSTOADP			  CODE	    0195	 125
PRINTLINE			  CODE	    01A2	 136

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PRINTLINE1			  CODE	    01BA	 151
PRINTLINEEX			  CODE	    01C5	 159
PRINTMENU			  CODE	    0124	  46
PRINTMENUEX			  CODE	    0137	  58
PS				  BIT	      BC
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
P_DATA				  NUMBER    00A0	  12
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SBUF				  DATA	      99
SCON				  DATA	      98
SELECTMENU			  CODE	    0138	  60
SENDCOMMANDS			  CODE	    0154	  80
SENDCOMMANDSEX			  CODE	    0169	  96
SETCGRAM			  CODE	    017F	 111
SETCGRAM1			  CODE	    0189	 115
SETTEXTMODE			  CODE	    01CA	 164
SETTEXTMODE1			  CODE	    01E6	 181
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
START				  CODE	    0100	  25
STATUS				  CODE	    0206	 209
STATUS1				  CODE	    020F	 213
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
TXTHOME				  NUMBER    1000	  15
WR				  BIT	      B6
WRITECOMMAND			  CODE	    01F0	 190

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 10



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
WRITEDATA			  CODE	    01FB	 199
