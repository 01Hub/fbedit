<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0044)http://members.a1.net/ranmasaotome/tut5.html -->
<HTML><HEAD><TITLE>Tutorial 5</TITLE>
<META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<META content="MSHTML 6.00.6000.16525" name=GENERATOR></HEAD>
<BODY bgColor=#a0b7cd>
<P>Have a look at our window from tutorial #3:</P>
<P><IMG height=276 alt="Start.jpg (16969 Byte)" src="tut5_files/Start.jpg" 
width=415></P><FONT size=4>
<P></FONT><FONT size=3>Looks nice but empty. We have a working toolbar with 
toolbar but no controls.<BR>Its time to add a Richedit control.<BR>Select the 
Richedit control from the Radasm toolbar on the left side and place it on your 
window in the dialog editor.<BR>the click Go!<BR>You will see nothing, even if 
Radasm/masm32 linked without any errors.<BR>Thats allright so, cause a Richedit 
control must be initialised before ( i mentioned this in tutorial #1 
once)</FONT></P>
<P><FONT size=3>&nbsp;First add:<BR><STRONG><FONT color=#ff0000>include 
riched20.inc<BR>includelib riched20.lib</FONT></STRONG><BR>to your *.inc 
file<BR><BR>in your <FONT color=#ff0000><STRONG>.data</STRONG> </FONT>section 
add<BR><STRONG><FONT color=#ff0000>RichEditDLL db 'riched20.dll',0<BR>hRichEdDLL 
dd 0</FONT></STRONG><BR><BR>and your <STRONG><FONT 
color=#ff0000>.data?</FONT></STRONG> section add<BR><STRONG><FONT 
color=#ff0000>iccex&nbsp;&nbsp;&nbsp; INITCOMMONCONTROLSEX 
&lt;?&gt;</FONT></STRONG><BR>Now close your *.inc file and open your *.asm 
file,<BR>under start: you see this:</FONT></P>
<P><FONT size=3><BR><STRONG><FONT color=#808080>start:<BR><BR>invoke 
GetModuleHandle,NULL<BR>mov hInstance,eax<BR>invoke GetCommandLine<BR>invoke 
InitCommonControls<BR>invoke 
WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT<BR>invoke 
ExitProcess,eax</FONT></STRONG><BR><BR>replace it with this:</FONT></P>
<P><FONT size=3><BR><STRONG><FONT color=#808080>start:<BR><BR>invoke 
GetModuleHandle,NULL<BR>mov hInstance,eax<BR>invoke 
GetCommandLine</FONT><BR><FONT color=#ff0000>invoke InitCommonControlsEx,OFFSET 
iccex<BR>invoke LoadLibrary,offset RichEditDLL<BR>mov 
hRichEdDLL,eax</FONT><BR><BR><FONT color=#808080>invoke 
WinMain,hInstance,NULL,CommandLine,SW_SHOWDEFAULT</FONT><BR><FONT 
color=#ff0000>push eax<BR>invoke FreeLibrary,hRichEdDLL<BR>pop 
eax</FONT><BR><FONT color=#808080>invoke 
ExitProcess,eax</FONT></STRONG><BR><BR>then click Go! again. Voilá your Richedit 
is ready to go. (not really ready to edit but already showing)</FONT></P>
<P><IMG height=276 alt="Richedit.jpg (22492 Byte)" src="tut5_files/Richedit.jpg" 
width=415></P><BIG>
<P></BIG>If you cant wait to get a real editor in assembler, <FONT 
color=#ff0000>RADASM</FONT> has a template in the wizard just waiting for 
you.<BR>click <U>&amp;Project</U> and <U>&amp;New Project</U>: from the Wizard 
choose <STRONG>RichEditEditor.tpl</STRONG> as template and finish the 
wizard.<BR>The click Go! You will get this:</P>
<P><IMG height=388 alt="RicheditEditor.jpg (30499 Byte)" 
src="tut5_files/RicheditEditor.jpg" width=469></P>
<P>We continue with our Tutorial:</P>
<P><IMG height=370 alt="Properties3.jpg (49266 Byte)" 
src="tut5_files/Properties3.jpg" width=228></P>
<P>This is the properties for our placed Richeditor control.<BR>We have to 
change a few things.<BR>You can leave NAME .</P>
<P>You have to change ID into 2000. Cause the give 1002 is already our in our 
toolbar.<BR>Change AUTOSCROLL into BOTH<BR>MULTILINE into TRUE<BR>SCROLLBAR into 
BOTH<BR>You can play with the rest.</P>
<P>here is the code for copy,cut and paste for your toolbar</P>
<P>WM_INITDIALOG:<BR><STRONG><FONT color=#0080ff>invoke</FONT><FONT 
color=#ff0000> GetDlgItem,hWin,IDC_RED1<BR>mov 
hRichEdit,eax</FONT></STRONG><BR>WM_COMMAND<BR><STRONG><FONT 
color=#0080ff>invoke</FONT><FONT color=#ff0000> 
SendMessage,hRichEdit,WM_COPY,0,0<BR></FONT><FONT 
color=#0080ff>invoke</FONT><FONT color=#ff0000> 
SendMessage,hRichEdit,WM_CUT,0,0<BR></FONT><FONT 
color=#0080ff>invoke</FONT><FONT color=#ff0000> 
SendMessage,hRichEdit,WM_PASTE,0,0<BR></FONT><FONT 
color=#0080ff>invoke</FONT><FONT color=#ff0000> 
SendMessage,hRichEdit,EM_UNDO,0,0<BR></FONT><FONT 
color=#0080ff>invoke</FONT><FONT color=#ff0000> 
SendMessage,hRichEdit,EM_REDO,0,0</FONT></STRONG></P>
<P>Now your editor has already some basic features. But its still a very long 
way to go.<BR>I am pretty sure you want to have a right click feature in your 
editor with a popup menu.<BR>Here is the code you have to place in your 
WndProc.<BR>First the local variable</P>
<P><STRONG><FONT color=#ff0000>LOCAL&nbsp;&nbsp;&nbsp; 
pt:POINT</FONT></STRONG></P>
<P>then place following:</P>
<P><STRONG><FONT color=#ff0000>&nbsp;&nbsp;&nbsp; </FONT><FONT 
color=#000000>.elseif eax==WM_CONTEXTMENU</FONT><FONT 
color=#ff0000><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,wParam<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT 
color=#000000>.if eax==hRichEdit</FONT><FONT 
color=#ff0000><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
mov &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,lParam<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
and &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,0FFFFh<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
mov &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
pt.x,eax<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
mov &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,lParam<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
shr &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,16<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
pt.y,eax<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</FONT><FONT color=#0080ff>invoke</FONT><FONT color=#ff0000> 
GetMenu,hWin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</FONT><FONT color=#0080ff>invoke</FONT><FONT color=#ff0000> 
GetSubMenu,eax,0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</FONT><FONT color=#0080ff>invoke </FONT><FONT 
color=#ff0000>TrackPopupMenu,eax,TPM_LEFTALIGN or 
TPM_RIGHTBUTTON,pt.x,pt.y,0,hWin,0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
xor &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
eax,eax<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ret<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </FONT><FONT 
color=#000000>.endif</FONT></STRONG></P>
<P>then click go! and right click inside your editor. Its easy.</P>
<P>Download this example from <A 
href="http://members.a1.net/ranmasaotome/masm32/Richeditor.zip">here.</A> 
</P></BODY></HTML>
